<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>MineShare</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
      :root {
        /* MineShare Color Palette */
        --gold: #FFD700;
        --purple: #6A0DAD;
        --white: #FFFFFF;
        --dark: #1A1A1A;
        --success: #4CAF50;
        --error: #F44336;
        --neutral: #E0E0E0;
        
        /* Computed colors */
        --gold-hover: #F0C800;
        --purple-hover: #550A8D;
        --gold-light: #FFF9E6;
        --purple-light: #F4E6FF;
        
        --gap: 12px;
        --border-radius: 16px;
        --border-radius-sm: 8px;
        
        /* Legacy compatibility */
        --fg: var(--dark);
        --muted: #666;
        --border: var(--neutral);
        --bg: var(--white);
        --primary: var(--purple);
        --primary-hover: var(--purple-hover);
        --danger: var(--error);
        --card-bg: #fafafa;
      }
      * { box-sizing: border-box; }
      html, body { margin: 0; padding: 0; }
      body {
        font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Arial, sans-serif;
        color: var(--dark);
        background: var(--white);
        width: 400px;
        max-height: 600px;
        overflow: hidden;
        line-height: 1.5;
        -webkit-font-smoothing: antialiased;
      }
      
      /* MineShare Header */
      .header {
        background: linear-gradient(135deg, var(--gold) 0%, #FFC700 100%);
        padding: 16px;
        text-align: center;
        box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);
      }
      
      .logo {
        font-family: 'Poppins', sans-serif;
        font-size: 22px;
        font-weight: 700;
        color: var(--purple);
        margin: 0;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }
      
      .logo-icon {
        font-size: 24px;
      }
      
      /* Tab navigation */
      .tabs { 
        display: flex; 
        background: var(--dark);
        border-bottom: 3px solid var(--gold);
      }
      .tab-btn { 
        flex: 1; 
        padding: 14px 8px; 
        border: none; 
        background: transparent; 
        cursor: pointer; 
        font-size: 13px; 
        font-weight: 500;
        font-family: 'Inter', sans-serif;
        color: rgba(255, 255, 255, 0.6);
        transition: all 0.3s ease;
        position: relative;
      }
      .tab-btn:hover { 
        background: rgba(255, 215, 0, 0.1);
        color: var(--gold);
      }
      .tab-btn.active { 
        color: var(--gold);
        background: rgba(255, 215, 0, 0.15);
      }
      .tab-btn.active::after {
        content: '';
        position: absolute;
        bottom: -3px;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--gold);
      }
      
      /* Tab content */
      .tab-content { 
        display: none; 
        padding: 16px; 
        max-height: 516px; 
        overflow-y: auto;
        background: #FAFAFA;
      }
      .tab-content.active { display: block; }
      
      /* Custom scrollbar */
      .tab-content::-webkit-scrollbar {
        width: 8px;
      }
      
      .tab-content::-webkit-scrollbar-track {
        background: var(--neutral);
        border-radius: 4px;
      }
      
      .tab-content::-webkit-scrollbar-thumb {
        background: var(--gold);
        border-radius: 4px;
      }
      
      .tab-content::-webkit-scrollbar-thumb:hover {
        background: var(--gold-hover);
      }
      
      /* Typography */
      h3 { 
        font-family: 'Poppins', sans-serif;
        margin: 12px 0 10px; 
        font-size: 16px; 
        font-weight: 700;
        color: var(--dark);
      }
      h4 { 
        font-family: 'Inter', sans-serif;
        margin: 10px 0 8px; 
        font-size: 13px; 
        font-weight: 600; 
        color: var(--purple);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      
      /* Buttons */
      button { 
        font-family: 'Inter', sans-serif;
        font-size: 13px; 
        padding: 10px 18px; 
        border: 2px solid transparent;
        border-radius: var(--border-radius-sm);
        cursor: pointer; 
        font-weight: 500; 
        transition: all 0.3s ease;
      }
      button:hover:not(:disabled) { 
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }
      button:active {
        transform: translateY(0);
      }
      button:disabled { opacity: 0.5; cursor: not-allowed; }
      button.btn-primary,
      button.primary { 
        background: var(--gold);
        color: var(--purple);
        border-color: var(--gold);
        font-weight: 600;
      }
      button.btn-primary:hover,
      button.primary:hover { 
        background: var(--gold-hover);
        box-shadow: 0 4px 16px rgba(255, 215, 0, 0.4);
      }
      button.btn-secondary,
      button.secondary {
        background: var(--white);
        color: var(--purple);
        border: 2px solid var(--purple);
      }
      button.btn-secondary:hover,
      button.secondary:hover {
        background: var(--purple-light);
      }
      button.btn-danger,
      button.danger { 
        background: var(--error);
        color: white; 
        border-color: var(--error);
      }
      button.btn-danger:hover,
      button.danger:hover { 
        background: #D32F2F;
      }
      button.btn-success,
      button.success { 
        background: var(--success);
        color: white; 
        border-color: var(--success);
      }
      button.btn-success:hover,
      button.success:hover {
        background: #45A049;
      }
      
      /* Forms */
      input[type="text"], input[type="number"], textarea, select { 
        width: 100%; 
        padding: 10px 14px; 
        border: 2px solid var(--neutral);
        border-radius: var(--border-radius);
        font-size: 13px; 
        font-family: 'Inter', sans-serif;
        transition: all 0.3s ease;
      }
      input:focus, textarea:focus, select:focus {
        outline: none;
        border-color: var(--gold);
        box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.2);
      }
      textarea { resize: vertical; min-height: 70px; }
      label { 
        display: block; 
        margin-bottom: 6px; 
        font-size: 12px; 
        font-weight: 600;
        color: var(--purple);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      .form-group { margin-bottom: 14px; }
      .checkbox-group label { 
        display: flex; 
        align-items: center; 
        gap: 8px; 
        font-size: 13px;
        font-weight: 400;
        text-transform: none;
        letter-spacing: 0;
        color: var(--dark);
        cursor: pointer;
        padding: 6px;
        border-radius: var(--border-radius-sm);
        transition: background 0.2s;
      }
      .checkbox-group label:hover {
        background: var(--gold-light);
      }
      .checkbox-group input[type="checkbox"] {
        width: 18px;
        height: 18px;
        cursor: pointer;
        accent-color: var(--gold);
      }
      
      /* Cards */
      .card { 
        background: var(--white);
        border: 2px solid var(--neutral);
        border-radius: var(--border-radius);
        padding: 14px; 
        margin-bottom: 12px;
        transition: all 0.3s ease;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }
      .card:hover {
        border-color: var(--gold);
        box-shadow: 0 4px 12px rgba(255, 215, 0, 0.2);
        transform: translateY(-2px);
      }
      .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
      .card-title { font-size: 14px; font-weight: 600; color: var(--dark); }
      .card-meta { font-size: 11px; color: #666; margin-top: 6px; }
      .card-actions { display: flex; gap: 8px; margin-top: 12px; }
      .card-actions button {
        flex: 1;
        font-size: 12px;
        padding: 8px 14px;
      }
      
      /* Grid layouts */
      .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--gap); }
      .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--gap); }
      
      /* Status messages */
      .status-msg { 
        padding: 10px 14px;
        border-radius: var(--border-radius-sm);
        font-size: 12px; 
        margin: 10px 0;
        font-weight: 500;
        border: 2px solid;
        animation: slideIn 0.3s ease;
      }
      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .status-msg.info { 
        background: var(--purple-light);
        color: var(--purple);
        border-color: var(--purple);
      }
      .status-msg.success { 
        background: #E8F5E9;
        color: #2E7D32;
        border-color: var(--success);
      }
      .status-msg.error { 
        background: #FFEBEE;
        color: #C62828;
        border-color: var(--error);
      }
      .status-msg.warning { 
        background: #FFF3E0;
        color: #E65100;
        border-color: #FF9800;
      }
      
      /* Badges */
      .badge { 
        display: inline-block; 
        padding: 4px 10px;
        border-radius: 12px; 
        font-size: 11px; 
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      .badge.listed { 
        background: var(--purple-light);
        color: var(--purple);
      }
      .badge.sold { 
        background: #E8F5E9;
        color: var(--success);
      }
      .badge.pending { 
        background: #FFF3E0;
        color: #F57C00;
      }
      
      /* Modal */
      .modal-overlay { 
        display: none; 
        position: fixed; 
        inset: 0; 
        background: rgba(26, 26, 26, 0.7);
        backdrop-filter: blur(4px);
        z-index: 1000; 
        align-items: center; 
        justify-content: center;
        animation: fadeIn 0.3s ease;
      }
      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      .modal-overlay.active { display: flex; }
      .modal { 
        background: white; 
        border-radius: var(--border-radius);
        padding: 24px; 
        max-width: 380px; 
        width: 90%; 
        max-height: 500px; 
        overflow-y: auto; 
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        border: 3px solid var(--gold);
        animation: modalSlideIn 0.3s ease;
      }
      @keyframes modalSlideIn {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .modal-header { 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        margin-bottom: 18px;
        padding-bottom: 12px;
        border-bottom: 2px solid var(--gold);
      }
      .modal-title { 
        font-family: 'Poppins', sans-serif;
        font-size: 18px; 
        font-weight: 700;
        color: var(--purple);
      }
      .modal-close { 
        background: none; 
        border: none; 
        font-size: 28px; 
        cursor: pointer; 
        padding: 0; 
        width: 32px; 
        height: 32px; 
        line-height: 1;
        color: var(--purple);
        border-radius: 50%;
        transition: all 0.2s;
      }
      .modal-close:hover {
        background: var(--gold-light);
        transform: rotate(90deg);
      }
      
      /* Wallet status */
      .wallet-status { 
        display: flex; 
        align-items: center; 
        gap: 10px; 
        padding: 12px 14px; 
        background: linear-gradient(135deg, var(--gold-light) 0%, var(--white) 100%);
        border-radius: var(--border-radius);
        font-size: 12px; 
        margin-bottom: 14px;
        border: 2px solid var(--neutral);
        transition: all 0.3s ease;
      }
      .wallet-status.connected { 
        border-color: var(--success);
        background: linear-gradient(135deg, #E8F5E9 0%, var(--white) 100%);
      }
      .wallet-status.disconnected { 
        border-color: var(--error);
        background: linear-gradient(135deg, #FFEBEE 0%, var(--white) 100%);
      }
      
      /* Stats */
      .stats { 
        display: grid; 
        grid-template-columns: repeat(3, 1fr); 
        gap: 10px; 
        margin: 14px 0;
      }
      .stat-card { 
        text-align: center; 
        padding: 14px 10px; 
        background: linear-gradient(135deg, var(--white) 0%, var(--gold-light) 100%);
        border-radius: var(--border-radius-sm);
        border: 2px solid var(--gold);
        transition: all 0.3s ease;
      }
      .stat-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 16px rgba(255, 215, 0, 0.3);
      }
      .stat-value { 
        font-family: 'Poppins', sans-serif;
        font-size: 20px; 
        font-weight: 700; 
        color: var(--purple);
      }
      .stat-label { 
        font-size: 10px; 
        color: #666; 
        margin-top: 4px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      
      /* Filters */
      .filters { 
        display: flex; 
        gap: 8px; 
        margin-bottom: 14px; 
        flex-wrap: wrap;
      }
      .filter-chip { 
        padding: 7px 14px; 
        border: 2px solid var(--neutral);
        border-radius: 20px; 
        font-size: 12px; 
        cursor: pointer; 
        background: white;
        transition: all 0.3s ease;
        font-weight: 500;
      }
      .filter-chip:hover {
        border-color: var(--gold);
        background: var(--gold-light);
      }
      .filter-chip.active { 
        background: var(--purple);
        color: white; 
        border-color: var(--purple);
        box-shadow: 0 2px 8px rgba(106, 13, 173, 0.3);
      }
      
      /* Empty state */
      .empty-state { text-align: center; padding: 40px 20px; color: var(--muted); }
      .empty-state-icon { font-size: 48px; margin-bottom: 12px; opacity: 0.3; }
      
      /* Domain list specific */
      #domain-list { 
        max-height: 180px; 
        overflow: auto; 
        border: 2px solid var(--neutral);
        background: white; 
        padding: 8px; 
        border-radius: var(--border-radius-sm);
      }
      #domain-list > div { 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        padding: 8px; 
        border-bottom: 1px solid var(--neutral);
        transition: background 0.2s;
      }
      #domain-list > div:hover {
        background: var(--gold-light);
      }
      #domain-list > div:last-child { border-bottom: none; }
      
      /* Price input */
      .price-input { 
        display: flex; 
        align-items: center; 
        gap: 10px;
      }
      .price-input input { flex: 1; }
      .price-input .currency { 
        font-size: 14px; 
        color: var(--purple);
        font-weight: 600;
      }
    </style>
  </head>
  <body>
    <!-- MineShare Header -->
    <div class="header">
      <h1 class="logo">
        <span class="logo-icon">‚õèÔ∏è</span>
        MineShare
      </h1>
    </div>

    <!-- Tab Navigation -->
    <div class="tabs">
      <button class="tab-btn active" data-tab="collection">üìä Collection</button>
      <button class="tab-btn" data-tab="listings">üíº Listings</button>
      <button class="tab-btn" data-tab="marketplace">üõí Market</button>
    </div>

    <!-- Collection Tab -->
    <div class="tab-content active" id="tab-collection">
      <div style="margin-bottom: 14px;">
        <button id="toggle" class="btn-secondary" style="width: 100%;">Toggle Overlay</button>
        <span id="status" style="margin-left: 8px; font-weight: 600; color: #666;">‚Äî</span>
      </div>

      <h3>Collection Settings</h3>
      
      <div class="wallet-status disconnected" id="wallet-status">
        <span style="font-size: 18px;">üí≥</span>
        <span id="wallet-text" style="flex: 1;">Wallet not connected</span>
        <button id="connect-wallet" class="btn-primary" style="padding: 6px 12px; font-size: 11px;">Connect</button>
      </div>

      <div style="margin-bottom: 14px;">
        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 10px; background: var(--gold-light); border-radius: var(--border-radius-sm); border: 2px solid var(--gold);">
          <input type="checkbox" id="pref-global" style="width: 20px; height: 20px; accent-color: var(--gold);" />
          <span style="font-size: 14px; font-weight: 600; color: var(--purple);">Enable data collection</span>
        </label>
      </div>

      <h4>Categories</h4>
      <div id="prefs-categories" class="checkbox-group" style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-bottom: 14px;">
        <label><input type="checkbox" data-key="urls" /> URLs (hashed)</label>
        <label><input type="checkbox" data-key="titles" /> Page titles</label>
        <label><input type="checkbox" data-key="timeOnPage" /> Time on pages</label>
        <label><input type="checkbox" data-key="interactions" /> Click/scroll</label>
        <label><input type="checkbox" data-key="referrers" /> Referrers</label>
        <label><input type="checkbox" data-key="sessions" /> Sessions</label>
        <label><input type="checkbox" data-key="categories" /> Categories</label>
        <label><input type="checkbox" data-key="keywords" /> Keywords</label>
      </div>

      <div class="grid-2" style="margin-bottom: 14px;">
        <button id="save-prefs" class="btn-primary">Save Settings</button>
        <button id="clear-data" class="btn-danger">Clear Data</button>
      </div>

      <div id="prefs-status" class="status-msg" style="display: none;"></div>

      <div id="storage-info" style="font-size: 12px; color: #666; margin: 14px 0; padding: 10px; background: var(--white); border-radius: var(--border-radius-sm); border: 2px solid var(--neutral);"></div>
      <div id="domain-list"></div>
    </div>

    <!-- My Listings Tab -->
    <div class="tab-content" id="tab-listings">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
        <h3 style="margin: 0;">My Data Listings</h3>
        <button id="create-listing-btn" class="btn-primary">+ Create Listing</button>
      </div>

      <div class="stats">
        <div class="stat-card">
          <div class="stat-value" id="stat-active-listings">0</div>
          <div class="stat-label">Active</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="stat-sold-listings">0</div>
          <div class="stat-label">Sold</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="stat-total-earnings">$0</div>
          <div class="stat-label">Earnings</div>
        </div>
      </div>

      <div id="my-listings-container"></div>
    </div>

    <!-- Marketplace Tab -->
    <div class="tab-content" id="tab-marketplace">
      <h3>Browse Data Marketplace</h3>
      
      <div class="filters" id="marketplace-filters">
        <button class="filter-chip active" data-filter="all">All</button>
        <button class="filter-chip" data-filter="browsing">Browsing</button>
        <button class="filter-chip" data-filter="social">Social Media</button>
        <button class="filter-chip" data-filter="shopping">Shopping</button>
        <button class="filter-chip" data-filter="video">Video</button>
      </div>

      <div class="form-group">
        <input type="text" id="search-marketplace" placeholder="Search by description or seller...">
      </div>

      <div id="marketplace-listings-container"></div>
    </div>

    <!-- Create Listing Modal -->
    <div class="modal-overlay" id="create-listing-modal">
      <div class="modal">
        <div class="modal-header">
          <h3 class="modal-title">Create Data Listing</h3>
          <button class="modal-close" id="close-create-modal">√ó</button>
        </div>

        <div class="form-group">
          <label>Listing Title</label>
          <input type="text" id="listing-title" placeholder="e.g., Browsing History - Tech Sites">
        </div>

        <div class="form-group">
          <label>Description</label>
          <textarea id="listing-description" placeholder="Describe your dataset..."></textarea>
        </div>

        <div class="form-group">
          <label>Data Type</label>
          <select id="listing-data-type">
            <option value="browsing">Browsing History</option>
            <option value="social">Social Media Activity</option>
            <option value="shopping">Shopping Behavior</option>
            <option value="video">Video Consumption</option>
            <option value="mixed">Mixed Activity</option>
          </select>
        </div>

        <div class="grid-2">
          <div class="form-group">
            <label>Data Size (events)</label>
            <input type="number" id="listing-size" value="0" readonly>
          </div>
          <div class="form-group">
            <label>Price (USD)</label>
            <div class="price-input">
              <span class="currency">$</span>
              <input type="number" id="listing-price" placeholder="0.00" step="0.01" min="0">
            </div>
          </div>
        </div>

        <div class="form-group">
          <label>Time Range</label>
          <input type="text" id="listing-timerange" readonly placeholder="Auto-calculated from data">
        </div>

        <div id="create-listing-status" class="status-msg" style="display: none;"></div>

        <div class="grid-2" style="margin-top: 16px;">
          <button id="cancel-create-listing" class="btn-secondary">Cancel</button>
          <button id="submit-create-listing" class="btn-primary">Create Listing</button>
        </div>
      </div>
    </div>

    <!-- Purchase Modal -->
    <div class="modal-overlay" id="purchase-modal">
      <div class="modal">
        <div class="modal-header">
          <h3 class="modal-title">Purchase Data</h3>
          <button class="modal-close" id="close-purchase-modal">√ó</button>
        </div>

        <div id="purchase-details"></div>

        <div class="status-msg warning" style="margin: 12px 0;">
          <strong>‚ö†Ô∏è Important:</strong> This transaction will be processed via blockchain. Make sure your wallet is connected and has sufficient funds.
        </div>

        <div id="purchase-status" class="status-msg" style="display: none;"></div>

        <div class="grid-2" style="margin-top: 16px;">
          <button id="cancel-purchase" class="btn-secondary">Cancel</button>
          <button id="confirm-purchase" class="btn-success">Confirm Purchase</button>
        </div>
      </div>
    </div>

    <script src="../api/marketplace.js"></script>
    <script src="../api/walrus.js"></script>
    <script src="popup.js"></script>
  </body>
</html>
